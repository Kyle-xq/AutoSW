C51 COMPILER V8.02   INFRED                                                                10/26/2015 20:59:19 PAGE 1   


C51 COMPILER V8.02, COMPILATION OF MODULE INFRED
OBJECT MODULE PLACED IN .\infred.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE ..\..\test_for_infred\infred.c BROWSE DEBUG OBJECTEXTEND PRINT(.\infred.lst
                    -) OBJECT(.\infred.obj)

line level    source

   1          #include "reg51.h"
   2          #include "infred.h"
   3          
   4          void infred_init (void )
   5          {
   6   1              //开启总中断
   7   1              //IE |= 0x80 ;
   8   1              //定义输出管脚
   9   1              ACC = P_SW1;
  10   1          ACC &= ~(CCP_S0 | CCP_S1);      //CCP_S0=0 CCP_S1=0
  11   1          P_SW1 = ACC;                    //(P1.2/ECI, P1.1/CCP0, P1.0/CCP1, P3.7/CCP2)
  12   1              //
  13   1              CCON = 0;                       //初始化PCA控制寄存器
  14   1                                          //PCA定时器停止
  15   1                                          //清除CF标志
  16   1                                          //清除模块中断标志
  17   1              
  18   1          CMOD = 0x08;                    //设置PCA时钟源 SYS_CLK
  19   1                                          //禁止PCA定时器溢出中断
  20   1              //PCA_PWM0 = 0x00;                //PCA模块0工作于8位PWM
  21   1          //CCAP0H = CCAP0L = 0x80;         //PWM0的占空比 ((100H-80H)/100H)
  22   1              
  23   1          CCAPM0 = 0x4C;                  //PCA模块0为16位高速脉冲模式
  24   1              //CCAP0L = 0x07;                                        //设置38KHz Fclk20Mhz/2/38Khz = 267 = 0x107
  25   1              //CCAP0H = 0x01;
  26   1              
  27   1              CCF0=0;
  28   1              
  29   1              CL = 0;                         //复位PCA寄存器
  30   1          CH = 0;
  31   1              CR = 0;                         //PCA定时器停止工作
  32   1              //EA = 1 ;
  33   1      }
  34          
  35          char infred_send_bit (char n)
  36          {
  37   1              int len_high;
  38   1              int cnt = 0;
  39   1              //T38KHz
  40   1              int t_38khz ;
  41   1              t_38khz = T38KHz ;
  42   1              CCAP0L = t_38khz;                                       //设置38KHz Fclk20Mhz/2/38Khz = 267 = 0x107
  43   1              CCAP0H = t_38khz>>8;
  44   1              t_38khz +=  T38KHz ;
  45   1              
  46   1              CR = 1;                         //PCA定时器开始工作
  47   1              
  48   1              switch ( n )
  49   1              {
  50   2                      case 0: len_high = INFRED_BIT_0;break; 
  51   2                      case 1: len_high = INFRED_BIT_1; break; 
  52   2                      default: len_high = INFRED_BIT_START; break; 
  53   2              }
  54   1              
C51 COMPILER V8.02   INFRED                                                                10/26/2015 20:59:19 PAGE 2   

  55   1              //发送高脉冲
  56   1              do {
  57   2                      
  58   2                      while(~CCF0);
  59   2                      CCF0=0;
  60   2                      CCAP0L = t_38khz;                                       //设置38KHz Fclk20Mhz/2/38Khz = 267 = 0x107
  61   2                      CCAP0H = t_38khz>>8;
  62   2                      t_38khz +=  T38KHz ;
  63   2                      cnt ++;
  64   2              }while(cnt < len_high);
  65   1              CR = 0;  
  66   1              //发送低脉冲
  67   1              for(cnt=0;cnt<2000;cnt++);
  68   1              
  69   1              return 1 ;
  70   1      }
  71          
  72          //发送１Ｂ　，　先发高位
  73          char infred_send_byte (char n)
  74          {
  75   1              int i=0 ;
  76   1              do{
  77   2                      if ((n>>i)&1)
  78   2                      //if (1)
  79   2                              infred_send_bit(0x01);
  80   2                      else
  81   2                              infred_send_bit(0x00);
  82   2                      i++;
  83   2              }while(i<8);
  84   1              
  85   1      }
*** WARNING C173 IN LINE 85 OF ..\..\TEST_FOR_INFRED\INFRED.C: missing return-expression
  86          
  87          extern char infred_send(char * str ,int len)
  88          {
  89   1              int i ;
  90   1              infred_send_bit(2); //发送开始位
  91   1              for ( i=0;i<len;i++) {
  92   2                      infred_send_byte(*(str+i));
  93   2              }
  94   1              return 1 ;
  95   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    249    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       9
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
